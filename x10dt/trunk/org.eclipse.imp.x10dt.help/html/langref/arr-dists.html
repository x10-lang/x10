<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">

<html>
<head>
<meta name="GENERATOR" content="TtH 3.80">
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
 <style type="text/css"> div.p { margin-top: 7pt;}</style>
 <style type="text/css"><!--
 td div.comp { margin-top: -0.6ex; margin-bottom: -1ex;}
 td div.comb { margin-top: -0.6ex; margin-bottom: -.6ex;}
 td div.hrcomp { line-height: 0.9; margin-top: -0.8ex; margin-bottom: -1ex;}
 td div.norm {line-height:normal;}
 span.roman {font-family: serif; font-style: normal; font-weight: normal;} 
 span.overacc2 {position: relative;  left: .8em; top: -1.2ex;}
 span.overacc1 {position: relative;  left: .6em; top: -1.2ex;} --></style>
	<title>Distributions</title>
</head>

<body>
 <h2><a name="tth_sEc3">
3</a>&nbsp;&nbsp;Distributions</h2><a name="XtenDistributions">
</a>


<div class="p"><!----></div>
A <em>distribution</em> is a mapping from a region to a set of places.
X10 provides a built-in class, <b>x10.lang.Dist</b>, to allow the creation of new distributions and
to perform operations on distributions. This class is <b>final</b> in
X10 v2.0; future versions of the language may permit
user-definable distributions. Since distributions play a dual role
(values as well as types), variables of type <b>Dist</b> must
be initialized and are implicitly <b>val</b>.


<div class="p"><!----></div>
The <em>rank</em> of a distribution is the rank of the underlying region.

<div class="p"><!----></div>

<div class="p"><!----></div>
<pre>
R: Region = 1..100;
D: Dist = Dist.makeBlock(R);
D: Dist = Dist.makeCyclic(R);
D: Dist = R -&#62; here;
D: Dist = Dist.random(R);
</pre>

<div class="p"><!----></div>
Let <b>D</b> be a distribution. <b>D.region</b> denotes the underlying
region. <b>D.places</b> is the set of places constituting the range of
<b>D</b> (viewed as a function). Given a point <b>p</b>, the expression
<b>D(p)</b> represents the application of <b>D</b> to <b>p</b>, that is,
the place that <b>p</b> is mapped to by <b>D</b>. The evaluation of the
expression <b>D(p)</b> throws an <b>ArrayIndexOutofBoundsException</b>
if <b>p</b> does not lie in the underlying region.

<div class="p"><!----></div>
When operated on as a distribution, a region <b>R</b> implicitly
behaves as the distribution mapping each item in <b>R</b> to <b>here</b>
(i.e., <b>R-&#62;here</b>, see below). Conversely, when used in a context
expecting a region, a distribution <b>D</b> should be thought of as
standing for <b>D.region</b>.

<div class="p"><!----></div>
     <h3><a name="tth_sEc3.1">
3.1</a>&nbsp;&nbsp;Operations returning distributions</h3>

<div class="p"><!----></div>
Let <b>R</b> be a region, <b>Q</b> a set of places {<b>p1</b>, ..., <b>pk</b>}
(enumerated in canonical order), and <b>P</b> a place. All the operations
described below may be performed on <b>Dist.factory</b>.

<div class="p"><!----></div>

<b>Unique distribution&nbsp;&nbsp;</b> 
The distribution <b>unique(Q)</b> is the unique distribution from the
region <b>1..k</b> to <b>Q</b> mapping each point <b>i</b> to <b>pi</b>.

<div class="p"><!----></div>

<b>Constant distributions.&nbsp;&nbsp;</b> 
The distribution <b>R-&#62;P</b> maps every point in <b>R</b> to <b>P</b>.

<div class="p"><!----></div>

<b>Block distributions.&nbsp;&nbsp;</b>
The distribution <b>block(R, Q)</b> distributes the elements of <b>R</b>
(in order) over the set of places <b>Q</b> in blocks  as
follows. Let p equal <b></td><td width="150">
&#124;R</td><td width="150">
&#124; div N</b> and q equal <b></td><td width="150">
&#124;R</td><td width="150">
&#124; mod N</b>,
where <b>N</b> is the size of <b>Q</b>, and 
<b></td><td width="150">
&#124;R</td><td width="150">
&#124;</b> is the size of <b>R</b>.  The first q places get
successive blocks of size (p+1) and the remaining places get blocks of
size p.

<div class="p"><!----></div>
The distribution <b>block(R)</b> is the same distribution as <tt>
block(R, Place.places)</tt>.

<div class="p"><!----></div>

<b>Cyclic distributions.&nbsp;&nbsp;</b> 
The distribution <b>cyclic(R, Q)</b> distributes the points in <b>R</b>
cyclically across places in <b>Q</b> in order.

<div class="p"><!----></div>
The distribution <b>cyclic(R)</b> is the same distribution as <b>cyclic(R, Place.places)</b>.

<div class="p"><!----></div>
Thus the distribution <b>cyclic(Place.MAX_PLACES)</b> provides a 1-1
mapping from the region <b>Place.MAX_PLACES</b> to the set of all
places and is the same as the distribution <b>unique(Place.places)</b>.

<div class="p"><!----></div>

<b>Block cyclic distributions.&nbsp;&nbsp;</b>
The distribution <b>blockCyclic(R, N, Q)</b> distributes the elements
of <b>R</b> cyclically over the set of places <b>Q</b> in blocks of size
<b>N</b>.

<div class="p"><!----></div>

<b>Arbitrary distributions.&nbsp;&nbsp;</b> 
The distribution <b>arbitrary(R,Q)</b> arbitrarily allocates points in <tt>
R</tt> to <b>Q</b>. As above, <b>arbitrary(R)</b> is the same distribution as
<b>arbitrary(R, Place.places)</b>.

<div class="p"><!----></div>

<b>Domain Restriction.&nbsp;&nbsp;</b> 

<div class="p"><!----></div>
If <b>D</b> is a distribution and <b>R</b> is a sub-region of <tt>
D.region</tt>, then <b>D </td><td width="150">
&#124; R</b> represents the restriction of <b>D</b> to
<b>R</b>.  The compiler throws an error if it cannot determine that
<b>R</b> is a sub-region of <b>D.region</b>.

<div class="p"><!----></div>

<b>Range Restriction.&nbsp;&nbsp;</b>

<div class="p"><!----></div>
If <b>D</b> is a distribution and <b>P</b> a place expression, the term
<b>D </td><td width="150">
&#124; P</b> denotes the sub-distribution of <b>D</b> defined over all the
points in the region of <b>D</b> mapped to <b>P</b>.

<div class="p"><!----></div>
Note that <b>D </td><td width="150">
&#124; here</b> does not necessarily contain adjacent points
in <b>D.region</b>. For instance, if <b>D</b> is a cyclic distribution,
<b>D </td><td width="150">
&#124; here</b> will typically contain points that are <b>P</b> apart,
where <b>P</b> is the number of places. An implementation may find a
way to still represent them in contiguous memory, e.g., using a
complex arithmetic function to map from the region index to an index
into the array.

<div class="p"><!----></div>
     <h3><a name="tth_sEc3.2">
3.2</a>&nbsp;&nbsp;User-defined distributions</h3>

<div class="p"><!----></div>
Future versions of X10 may provide user-defined distributions, in
a way that supports static reasoning.

<div class="p"><!----></div>
     <h3><a name="tth_sEc3.3">
3.3</a>&nbsp;&nbsp;Operations on distributions</h3>

<div class="p"><!----></div>
A <em>sub-distribution</em> of <b>D</b> is
any distribution <b>E</b> defined on some subset of the region of
<b>D</b>, which agrees with <b>D</b> on all points in its region.
We also say that <b>D</b> is a <em>super-distribution</em> of
<b>E</b>. A distribution  <em>is larger than</em>
"D<sub>2</sub>" if "D<sub>1</sub>" is a super-distribution of
"D<sub>2</sub>".

<div class="p"><!----></div>
Let "D<sub>1</sub>" and "D<sub>2</sub>" be two distributions.  

<div class="p"><!----></div>

<b>Intersection of distributions.&nbsp;&nbsp;</b>
"D<sub>1</sub> &amp;&amp; D<sub>2</sub>", the intersection of "D<sub>1</sub>"
and "D<sub>2</sub>", is the largest common sub-distribution of
"D<sub>1</sub>" and "D<sub>2</sub>".

<div class="p"><!----></div>

<b>Asymmetric union of distributions.&nbsp;&nbsp;</b>
"D<sub>1</sub>.overlay(D<sub>2</sub>)", the asymmetric union of
"D<sub>1</sub>" and "D<sub>2</sub>", is the distribution whose
region is the union of the regions of "D<sub>1</sub>" and
, and whose value at each point <b>p</b> in its
region is "D<sub>2</sub>(p)" if "p" lies in
"D<sub>2</sub>.region" otherwise it is "D<sub>1</sub>(p)".
("D<sub>1</sub>" provides the defaults.)

<div class="p"><!----></div>

<b>Disjoint union of distributions.&nbsp;&nbsp;</b>
"D<sub>1</sub> </td><td width="150">
&#124;</td><td width="150">
&#124; D<sub>2</sub>", the disjoint union of "D<sub>1</sub>"
and "D<sub>2</sub>", is defined only if the regions of
"D<sub>1</sub>" and "D<sub>2</sub>" are disjoint. Its value is
"D<sub>1</sub>.overlay(D<sub>2</sub>)" (or equivalently
"D<sub>2</sub>.overlay(D<sub>1</sub>)".  (It is the least
super-distribution of "D<sub>1</sub>" and "D<sub>2</sub>".)

<div class="p"><!----></div>

<b>Difference of distributions.&nbsp;&nbsp;</b>
"D<sub>1</sub> - D<sub>2</sub>" is the largest sub-distribution of
"D<sub>1</sub>" whose region is disjoint from that of
"D<sub>2</sub>".

<div class="p"><!----></div>
     <h3><a name="tth_sEc3.4">
3.4</a>&nbsp;&nbsp;Example</h3>
<pre>
def dotProduct(a: Array[T](D), b: Array[T](D)): Array[Double](D) =
  (new Array[T]([1:D.places],
      (Point) =&#62; (new Array[T](D </td><td width="150">
&#124; here,
                    (i): Point) =&#62; a(i)*b(i)).sum())).sum();
</pre>

<div class="p"><!----></div>
This code returns the inner product of two <b>T</b> vectors defined
over the same (otherwise unknown) distribution. The result is the sum
reduction of an array of <b>T</b> with one element at each place in the
range of <b>D</b>. The value of this array at each point is the sum
reduction of the array formed by multiplying the corresponding
elements of <b>a</b> and <b>b</b> in the local sub-array at the current
place.

<div class="p"><!----></div>

</body>
</html>