<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">

<html>
<head>
<meta name="GENERATOR" content="TtH 3.80">
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
 <style type="text/css"> div.p { margin-top: 7pt;}</style>
 <style type="text/css"><!--
 td div.comp { margin-top: -0.6ex; margin-bottom: -1ex;}
 td div.comb { margin-top: -0.6ex; margin-bottom: -.6ex;}
 td div.hrcomp { line-height: 0.9; margin-top: -0.8ex; margin-bottom: -1ex;}
 td div.norm {line-height:normal;}
 span.roman {font-family: serif; font-style: normal; font-weight: normal;} 
 span.overacc2 {position: relative;  left: .8em; top: -1.2ex;}
 span.overacc1 {position: relative;  left: .6em; top: -1.2ex;} --></style>
	<title>Clock operations</title>
</head>

<body>
 <h2><a name="tth_sEc1">
1</a>&nbsp;&nbsp;Clock operations</h2><a name="sec:clock">
</a>

There are two language constructs for working with clocks. 
<b>async clocked(cl) S</b> starts a new activity registered on one or more
clocks.  <b>next;</b> blocks the current activity until all the activities
sharing clocks with it are ready to proceed to the next clock phase. 
Clocks are objects, and have a number of useful methods on them as well.

<div class="p"><!----></div>
     <h3><a name="tth_sEc1.1">
1.1</a>&nbsp;&nbsp;Creating new clocks</h3><a name="sec:clock:create">
</a>

<div class="p"><!----></div>
Clocks are created using a factory method on <b>x10.lang.Clock</b>:

<div class="p"><!----></div>
<pre>
val c: Clock = Clock.make();
</pre>

<div class="p"><!----></div>

<div class="p"><!----></div>
The current activity is automatically registered with the newly
created clock.  It may deregister using the <b>drop</b> method on
clocks (see the documentation of <b>x10.lang.Clock</b>). All activities
are automatically deregistered from all clocks they are registered
with on termination (normal or abrupt).

<div class="p"><!----></div>
     <h3><a name="tth_sEc1.2">
1.2</a>&nbsp;&nbsp;Registering new activities on clocks</h3>
<a name="sec:clock:register">
</a>

<div class="p"><!----></div>
The statement 

<div class="p"><!----></div>
<pre>
  async clocked (c1, c2, c3) S
</pre>
starts a new activity, initially registered with
clocks <b>c1</b>, <b>c2</b>, and <b>c3</b>, and  running <b>S</b>. The activity running this code must
be registered on those clocks. 
Violations of these conditions are punished by the throwing of a
<b>ClockUseException</b>. 

<div class="p"><!----></div>

<div class="p"><!----></div>
If an activity a that has executed <b>c.resume()</b> then starts a
new activity b also registered on <b>c</b> (<em>e.g.</em>, via <b>async
clocked(c) S</b>), the new activity b starts out having also resumed
<b>c</b>, as if it too had executed <b>c.resume()</b>.  
<pre>
// a
val c = Clock.make();
c.resume();
async clocked(c) {
  // b
  c.next();
  b_phase_two();
}
c.next();
a_phase_two();
</pre>
In the proper execution, a and b both perform
<b>c.next()</b> and then their phase-2 actions.  
However, if b were not
initially in the resume state for <b>c</b>, there would be a race condition;
b could perform <b>c.next()</b> and proceed to <b>b_phase_two</b>
before a performed <b>c.next()</b>.

<div class="p"><!----></div>
An activity may check that it is registered on a clock <b>c</b> by
the predicate <b>c.registered()</b>

<div class="p"><!----></div>
 Note:
X10 does not contain a "register" operation that would allow an activity
to discover a clock in a datastructure and register itself on it. Therefore,
while a clock <b>c</b> may be stored in a data structure by one activity
<b>a</b> and read from it by another activity <b>b</b>, <b>b</b> cannot do much
with <b>c</b> unless it is already registered with it.  In particular, it
cannot register itself on <b>c</b>, and, lacking that registration, cannot
register a sub-activity on it with <b>async clocked(c) S</b>.


<div class="p"><!----></div>
     <h3><a name="tth_sEc1.3">
1.3</a>&nbsp;&nbsp;Resuming clocks</h3><a name="resume">
</a><a name="sec:clock:resume">
</a>
X10 permits <em>split phase</em> clocks. An activity may wish
to indicate that it has completed whatever work it wishes to perform
in the current phase of a  clock <b>c</b> it is registered with, without
suspending altogether. It may do so  by executing 
<b>c.resume()</b>.

<div class="p"><!----></div>
An activity may invoke <b>resume()</b> only on a clock it is registered with,
and has not yet dropped (&#167;). A
<b>ClockUseException</b> is thrown if this
condition is violated. Nothing happens if the activity has already invoked a
<b>resume</b> on this clock in the current phase.

<div class="p"><!----></div>

<div class="p"><!----></div>
     <h3><a name="tth_sEc1.4">
1.4</a>&nbsp;&nbsp;Advancing clocks</h3><a name="sec:clock:next">
</a>
An activity may execute the statement
<pre>
next;
</pre>

<div class="p"><!----></div>
 Execution of this statement blocks until all the clocks that the
activity is registered with (if any) have advanced. (The activity
implicitly issues a <b>resume</b> on all clocks it is registered
with before suspending.)

<div class="p"><!----></div>
<b>next;</b> may be thought of as calling <b>c.next()</b> in parallel for all
clocks that the current activity is registered with.  (The parallelism is
conceptually important: if activities a and b are both
registered on clocks <b>c</b> and <b>d</b>, and a executes
<b>c.next(); d.next()</b> while b executes <b>d.next(); c.next()</b>,
then the two will deadlock.  However, if the two clocks are waited on in
parallel, as <b>next;</b> does, a and b will not deadlock.)

<div class="p"><!----></div>
Equivalently, <b>next;</b> sequentially calls <b>c.resume()</b> for each
registered clock <b>c</b>, in arbitrary order, and then <b>c.wait()</b> for each
clock, again in arbitrary order.  

<div class="p"><!----></div>

<div class="p"><!----></div>
An activity blocked on <b>next</b> resumes execution once
it is marked for progress by all the clocks it is registered with.

<div class="p"><!----></div>
     <h3><a name="tth_sEc1.5">
1.5</a>&nbsp;&nbsp;Dropping clocks</h3><a name="sec:clock:drop">
</a>
An activity may drop a clock by executing <b>c.drop()</b>.

<div class="p"><!----></div>
 The activity is no longer considered registered with this
clock.  A <b>ClockUseException</b> is thrown if the activity has
already dropped <b>c</b>.

<div class="p"><!----></div>

</body>
</html>